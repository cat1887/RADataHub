{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "GDP data from BEA, Q3 2022. Population estimate from Census Bureau, Mid-2022. District of Columbia filtered out as distorts relative differences",
  "width": 550,
  "height": 360,
  "config": {"view": {"stroke": null}, "padding": 0},
  "data": {
    "url": "https://raw.githubusercontent.com/jhellingsdata/RADataHub/main/e4e/ch1_GDP/data/chart1_5_us_map_gdp_US_States_5m.json",
    "format": {"property": "features"}
  },
  "title": {
    "text": "GDP in the United States",
    "fontSize": 16,
    "dx": 10,
    "subtitle": ["Current GDP per capita 2022", "Data: BEA; Census Bureau", ""],
    "align": "left",
    "subtitleFontStyle": "italic",
    "subtitleFontSize": 12,
    "anchor": "start",
    "color": "black"
  },
  "projection": {"type": "albersUsa", "translate": [260, 190], "scale": 700},
  "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.5},
  "encoding": {
    "color": {
      "field": "Current GDP per capita",
      "legend": {
        "title": "",
        "orient": "none",
        "legendX": 12,
        "legendY": -5,
        "direction": "horizontal",
        "format": "$,d"
      },
      "type": "quantitative",
      "scale": {"scheme": "yellowgreenblue", "reverse": false}
    },
    "tooltip": [
      {"field": "properties.NAME", "title": "State"},
      {"field": "Population", "format": ","},
      {"field": "Current GDP", "title": "GDP ($m)", "format": "$,d"},
      {
        "field": "Current GDP per capita",
        "title": "GDP pc, current",
        "format": "$,d"
      }
    ]
  },
  "transform": [
    {
      "lookup": "properties.NAME",
      "from": {
        "key": "State",
        "fields": [
          "Current GDP",
          "Real GDP",
          "Population",
          "Current GDP per capita",
          "Real GDP per capita"
        ],
        "data": {
          "url": "https://raw.githubusercontent.com/jhellingsdata/RADataHub/main/e4e/ch1_GDP/data/chart1_5_us_map_gdp.csv"
        }
      }
    },
    {"filter": "datum['properties.NAME'] != 'District of Columbia'"}
  ]
}